(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,77851,e=>{"use strict";var t=e.i(27493),r=e.i(4);function n(){let e=(0,r.useRef)(null),n=(0,r.useRef)(null),a=(0,r.useRef)(null),l=(0,r.useRef)(!1),c=(0,r.useRef)([]),i=(0,r.useRef)([]),s=(0,r.useRef)(1);return(0,r.useEffect)(()=>{let t,r;async function o(){if(l.current)return;l.current=!0;let t=e.current,r=a.current;r.getContext("2d").drawImage(t,0,0,r.width,r.height),r.toBlob(async e=>{if(!e){l.current=!1;return}try{let t=new FormData;t.append("file",e,"frame.jpg");let r=await fetch("https://hallucination.calmwave-93bbec10.brazilsouth.azurecontainerapps.io/detect",{method:"POST",body:t}),n=(await r.json()).polygons??[];c.current=i.current.length?i.current:n,i.current=n,s.current=0}catch(e){console.error(e)}finally{l.current=!1}},"image/jpeg",.6)}return async function l(){let l=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480}}),u=e.current;u.srcObject=l,u.onloadedmetadata=()=>{let l;u.play(),l=e.current,n.current.width=l.videoWidth,n.current.height=l.videoHeight,a.current.width=l.videoWidth,a.current.height=l.videoHeight,function e(){let t=n.current,a=t.getContext("2d");a.clearRect(0,0,t.width,t.height),a.strokeStyle="#00ff00",a.lineWidth=3,i.current.map((e,t)=>{var r,n;return r=c.current[t]??e,n=s.current,r&&r.length===e.length?r.map((t,r)=>{var a,l;return{x:(a=t.x,a+(e[r].x-a)*n),y:(l=t.y,l+(e[r].y-l)*n)}}):e}).forEach(e=>{a.beginPath(),e.forEach((e,r)=>{let n=e.x*t.width,l=e.y*t.height;0===r?a.moveTo(n,l):a.lineTo(n,l)}),a.closePath(),a.stroke()}),s.current=Math.min(s.current+.08,1),r=requestAnimationFrame(e)}(),t=setInterval(o,1e3)}}(),()=>{clearInterval(t),cancelAnimationFrame(r)}},[]),(0,t.jsxs)("div",{className:"relative w-[640px] h-[480px] bg-black",children:[(0,t.jsx)("video",{ref:e,className:"absolute top-0 left-0 w-full h-full object-cover rounded-xl",muted:!0,playsInline:!0,autoPlay:!0}),(0,t.jsx)("canvas",{ref:n,className:"absolute top-0 left-0 w-full h-full pointer-events-none"}),(0,t.jsx)("canvas",{ref:a,className:"hidden"})]})}function a({children:e}){return(0,t.jsxs)("div",{className:"relative hud-panel",children:[(0,t.jsx)("span",{className:"hud-corner top-left"}),(0,t.jsx)("span",{className:"hud-corner top-right"}),(0,t.jsx)("span",{className:"hud-corner bottom-left"}),(0,t.jsx)("span",{className:"hud-corner bottom-right"}),e]})}function l({demo:e=null}){let[n,l]=(0,r.useState)(0);return(0,r.useEffect)(()=>{let t;if(null!==e)return void l(e);let r=async()=>{try{let e=await fetch("https://hallucination.calmwave-93bbec10.brazilsouth.azurecontainerapps.io/status"),t=await e.json();l(t.people_detected??0)}catch{l(e=>e>=3?1:e+1)}};return r(),t=setInterval(r,4e3),()=>clearInterval(t)},[e]),(0,t.jsxs)(a,{children:[(0,t.jsx)("h2",{className:"text-xs text-green-400 uppercase tracking-widest",children:"People Detected"}),(0,t.jsx)("p",{className:"mt-4 text-5xl font-bold text-green-400",children:n}),(0,t.jsx)("p",{className:"mt-2 text-xs text-zinc-500",children:"Camera-based detection"})]})}function c({sceneState:e}){let r=function(e){switch(e){case"EMPTY_ENVIRONMENT":return{label:"No people detected",color:"text-green-400",border:"border-green-700"};case"SINGLE_PERSON_PRESENT":return{label:"One person detected",color:"text-green-300",border:"border-green-600"};case"MULTIPLE_PEOPLE_PRESENT":return{label:"Multiple people detected",color:"text-yellow-400",border:"border-yellow-600"};case"CROWD_ENVIRONMENT":return{label:"Crowded environment",color:"text-red-400",border:"border-red-700"};default:return{label:"Analyzing environment",color:"text-zinc-400",border:"border-zinc-700"}}}(e);return(0,t.jsxs)("div",{className:`rounded-xl border ${r.border} bg-zinc-950 p-6`,children:[(0,t.jsx)("h2",{className:"text-sm uppercase text-zinc-500",children:"Environment status"}),(0,t.jsx)("p",{className:`mt-4 text-xl font-semibold ${r.color}`,children:r.label})]})}let i="lumi";function s({peopleDetected:e,sceneState:n}){let a=(0,r.useRef)(null),l=(0,r.useRef)(null),c=(0,r.useRef)(!1),s=(0,r.useRef)(!1),[o,u]=(0,r.useState)("idle");async function d(t){let r=await fetch("https://hallucination.calmwave-93bbec10.brazilsouth.azurecontainerapps.io/voice",{method:"POST",headers:{"Content-Type":"application/json",Accept:"audio/mpeg"},body:JSON.stringify({text:t,people_detected:e,scene_state:n})});if(!r.ok)throw Error(`Voice API failed: ${r.status}`);return await r.blob()}function h(){c.current=!1,s.current=!1,u("idle")}return(0,t.jsxs)("button",{onClick:function(){if(c.current)return;let e=window.SpeechRecognition||window.webkitSpeechRecognition;if(!e)return void alert("Speech Recognition not supported");c.current=!0,s.current=!1;let t=new e;t.lang="en-US",t.continuous=!1,t.interimResults=!1,t.onresult=async e=>{if(s.current)return;s.current=!0;let r=e.results?.[0]?.[0]?.transcript?.trim().toLowerCase();if(!r||r===i)return void h();let n=r.startsWith(i)?r.replace(i,"").trim():r;if(!n)return void h();t.stop(),u("thinking");try{var a;let e,t;a=await d(n),u("speaking"),l.current&&(l.current.pause(),l.current.src="",l.current=null),e=URL.createObjectURL(a),l.current=t=new Audio(e),t.onended=()=>{URL.revokeObjectURL(e),h()},t.onerror=()=>{URL.revokeObjectURL(e),h()},t.play().catch(h)}catch(e){console.error("Voice error:",e),h()}},t.onerror=()=>{t.stop(),h()},a.current=t,u("listening"),t.start()},disabled:"idle"!==o,className:"w-full rounded-xl bg-blue-600 px-4 py-3 font-semibold disabled:opacity-50",children:["idle"===o&&"ðŸŽ™ Speak","listening"===o&&"ðŸ‘‚ Listening...","thinking"===o&&"ðŸ§  Thinking...","speaking"===o&&"ðŸ”Š Speaking..."]})}function o(){let[e,a]=(0,r.useState)(0),[i,o]=(0,r.useState)("UNKNOWN");return(0,r.useEffect)(()=>{let e=async()=>{try{let e=await fetch("https://hallucination.calmwave-93bbec10.brazilsouth.azurecontainerapps.io/status"),t=await e.json();a(t.people_detected??0),o(t.scene_state??"UNKNOWN")}catch{}};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[]),(0,t.jsxs)("main",{className:"min-h-screen bg-black text-white flex flex-col items-center gap-6 p-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold",children:"Hallucination Checker â€” Interactive Demo"}),(0,t.jsx)(n,{}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsx)(l,{demo:e}),(0,t.jsx)(c,{sceneState:i})]}),(0,t.jsx)(s,{peopleDetected:e,sceneState:i})]})}e.s(["default",()=>o],77851)}]);